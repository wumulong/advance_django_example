
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="进阶 Django 教程">
      
      
      
        <meta name="author" content="陈坚">
      
      
        <link rel="shortcut icon" href="./assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.3">
    
    
      
        <title>进阶 Django 教程</title>
      
    
    
      <script src="./assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="./assets/stylesheets/application-e2807e330f.css">
      
        <link rel="stylesheet" href="./assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source Sans Pro:300,400,400i,700|Source+Code+Pro">
        <style>body,input{font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="light-blue" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="." title="进阶 Django 教程" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            README.md
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/lsdlab/advance_django_example" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      lsdlab/advance_django_example
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    进阶 Django 教程
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/lsdlab/advance_django_example" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      lsdlab/advance_django_example
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        README.md
      </label>
    
    <a href="." title="README.md" class="md-nav__link md-nav__link--active">
      README.md
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="任务队列/定时任务" class="md-nav__link">
    任务队列/定时任务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="搜索" class="md-nav__link">
    搜索
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" title="API" class="md-nav__link">
    API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="图片处理" class="md-nav__link">
    图片处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="本地开发辅助" class="md-nav__link">
    本地开发辅助
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="前端结合" class="md-nav__link">
    前端结合
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sentry" title="接入 Sentry 和部署问题" class="md-nav__link">
    接入 Sentry 和部署问题
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="structure/" title="Structure" class="md-nav__link">
      Structure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="up_and_running/" title="up & running" class="md-nav__link">
      up & running
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter1/" title="第一章 - 任务队列 Celery" class="md-nav__link">
      第一章 - 任务队列 Celery
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter2/" title="第二章 - 另一个任务队列 django-rq" class="md-nav__link">
      第二章 - 另一个任务队列 django-rq
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter3/" title="第三章 - 简单定时任务 django-crontab" class="md-nav__link">
      第三章 - 简单定时任务 django-crontab
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter4/" title="第四章 - 复杂搜索 django-elasticsearch" class="md-nav__link">
      第四章 - 复杂搜索 django-elasticsearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter5/" title="第五章 - 用户模块 App 的视图实现及 RESTful API 实现" class="md-nav__link">
      第五章 - 用户模块 App 的视图实现及 RESTful API 实现
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter6/" title="第六章 - 用户模块 App 的GraphQL 实现" class="md-nav__link">
      第六章 - 用户模块 App 的GraphQL 实现
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter7/" title="第七章 - 打标签 django-taggit" class="md-nav__link">
      第七章 - 打标签 django-taggit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter8/" title="第八章 - 信息流 django-activity-stream" class="md-nav__link">
      第八章 - 信息流 django-activity-stream
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter9/" title="第九章 - 验证码和图片处理 django-simple-captcha and django-imagekit" class="md-nav__link">
      第九章 - 验证码和图片处理 django-simple-captcha and django-imagekit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter10/" title="第十章 - 本地开发辅助 django-debug-toolbar 和 django-extensions" class="md-nav__link">
      第十章 - 本地开发辅助 django-debug-toolbar 和 django-extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter11/" title="第十一章 - 前端结合 django-turbolinks 和 Webpack django-webpack-loader" class="md-nav__link">
      第十一章 - 前端结合 django-turbolinks 和 Webpack django-webpack-loader
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter12/" title="第十二章 - 接入 Sentry" class="md-nav__link">
      第十二章 - 接入 Sentry
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="chapter13/" title="第十三章 - 部署及 API Benchmark" class="md-nav__link">
      第十三章 - 部署及 API Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="draft/" title="草稿" class="md-nav__link">
      草稿
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="任务队列/定时任务" class="md-nav__link">
    任务队列/定时任务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="搜索" class="md-nav__link">
    搜索
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" title="API" class="md-nav__link">
    API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="图片处理" class="md-nav__link">
    图片处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="本地开发辅助" class="md-nav__link">
    本地开发辅助
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="前端结合" class="md-nav__link">
    前端结合
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sentry" title="接入 Sentry 和部署问题" class="md-nav__link">
    接入 Sentry 和部署问题
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="django">Django 进阶教程<a class="headerlink" href="#django" title="Permanent link">&para;</a></h1>
<p><img alt="Language" src="https://img.shields.io/badge/language-Python-blue.svg?style=flat-square" /> <img alt="License" src="https://img.shields.io/badge/license-MIT-blue.svg?style=flat-square" /></p>
<p><a href="https://www.djangoproject.com/">Django</a> 是一个有着十二年历史的 Python Web 框架，是 Python Web 开发中最流行的框架。因为 Python 容易上手的特性，有大量的第三方库，能够快速开发，也能够获得非常好的稳定性和性能，MVC 的设计也非常用以理解，所以新手选择 Django 作为一个启蒙框架是非常适合的。尽管我后来学了 Node.js, Rails 等等，但我依然记得 Django 就是我的第一个学习的 Web 开发框架，因 Django 可插拔 App 这一特性给我留下了很深的印象。</p>
<p>虽然 Django 架构的大型网站和服务也不少，像 <a href="https://engineering.instagram.com/what-powers-instagram-hundreds-of-instances-dozens-of-technologies-adf2e22da2ad">Instagram</a> 就是一个以 Django 为基础的大型应用。国内的例子就很少，因为国内本身使用 Python 的公司就很少，很多都是用在运维方面，爬虫方面，各个公司可能会基于一些开源项目开发内部使用的自动化运维平台，因为自动化运维基本都是用 shell, Python 的各种开源库，所以用 Django 也是最佳选择。</p>
<p>我写的这篇教程不包含基础的 Django 内容，也不包含基础的 Python 内容，Python 和 Django 都是使用的最新的，分别是 3.6.1 和 1.11。基础的 Django 教程可以去很多地方找到教程，CRUD 看看官方文档的 Tutorial 就能上手了，英文够好的话看文档是最佳选择，因为文档里面也包含了很多的示例代码。</p>
<p>这篇教程包含了使用 Django 在 Web 开发中遇到的常见问题的解决方案，包含了简单的示例应用，总共分为三部分，第一部分是任务队列和搜索，第一章到第四章；第二部分是两个实战 App 的 视图及 API 实现，API 实现有两种，一种是常见的 RESTFul，还有一种是 GraphQL，穿插介绍了打标签和信息流这两个库，第五章到第八章；第三部分是本地开发辅助工具 django-debug-toolbar 和 django-extensions，前端结合 Webpack，以及接入 Sentry 异常捕获服务，结合 Ansible 在本地进行自动化部署 Django 应用，包含 CLI 和 GUI 实现，最后会对 API 进行一个 Benchmark，第九章到第十二章。</p>
<p>详细的目录在项目中的 GitHub Pages 能看到，GitHub Pages 是用的 <a href="http://mkdocs.org">MkDocs</a> 生成的，用了一个 Material Design 的主题，字体是 Souce Sans Pro 和 Source Code Pro，还挺好看，可读性也不错，目录、TOC 都有，还有 GFM 的语法，想直接读阅读 GitHub 渲染的 md 文件可以直接到 <code>docs</code> 目录打开文件。README 中我就不放目录了，简单介绍下这个教程中涉及到了那些内容，有那些示例。</p>
<h2 id="_1">任务队列/定时任务<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>任务队列将介绍两个库的使用，一个是功能比较多的 <a href="http://docs.celeryproject.org/en/latest/index.html">Celery</a>，另一个是功能较为简单的 <a href="https://github.com/ui/django-rq">django-rq</a>，Celery 提供了非常易用的 API 来实现任务队列和定时任务，用 django-rq 实现定时任务则需要手动实现定时入队这一过程，当然如果你只需要简单的定时任务的话 <a href="https://github.com/kraiz/django-crontab">django-corntab</a> 也是一个非常好的选择。</p>
<h2 id="_2">搜索<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>ElasticSearch 也是一个在 Web 应用中经常使用的东西，一个搜索引擎后端，被用来索引复杂数据，如商品属性数据，或者用来处理大量日志，教程中也包含了如何在 Django 中使用 <a href="https://github.com/liberation/django-elasticsearch">django-elasticsearch</a> 这个库的示例。</p>
<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<p>Django 有一个非常方便使用的 RESTFul API 库，叫做 <a href="http://www.django-rest-framework.org">Django REST framework</a>，只要定义好 model，serializer，在根据业务写好视图层的代码，加上 <a href="http://getblimp.github.io/django-rest-framework-jwt/">Django REST framework JWT</a> 作为 API token 保护，就能提供一个完整的 API 后端服务。示例代码中也包含了一个简单的用户应用（登录注册）的视图层和 API 层实现，包含了基本的功能，登录注册、修改资料、修改密码、删除账户，全部提供了 RESTFul API 实现，另外也包含了这个用户 App 的 GraphQL 实现。</p>
<h2 id="_3">图片处理<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>图片处理也是 Web 开发中很常见的需求，用户上传的头像、图片可能很大，需要裁剪，需要处理成大中小尺寸和略缩图来保存，以方便不同页面的展示。教程中包含了简单用户注册是给表单添加一个验证码，防止应用被恶意爬虫盯上进行垃圾用户注册，也简单介绍了用 django-imagekit 进行图片处理。</p>
<h2 id="_4">本地开发辅助<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>介绍了两个本地开发辅助工具：django-debug-toolbar 和 django-extensions，django-debug-toolbar 能在本地测试的时候页面右侧有个可隐藏的面板，看到一些调试信息，应用变量、SQL 执行时间、模板文件、运行时间等等。django-extensions 给 Django 应用的 manage.py 添加了命令，比如查看应用的全部 URL 和对于的方法，可视化应用的 model，验证模板等等。</p>
<h2 id="_5">前端结合<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>前端结合介绍了一个非常神奇的包，让 Django 应用也能获得非常接近单页应用的用户体验，来自 Rails 社区的 <a href="https://github.com/turbolinks/turbolinks">Turbolinks</a>，有人根据 Django 的 middleware 原理开发了适合 Django 的包，非常容易接入，就能让 Django 应用使用体验大变样。还介绍了一个 Django 结合 Webpack 的工具，Webpack 是现在前端最流行的打包工具，用来打包全部前端内容，CSS/JS/字体/图片，我也使用过 Django 的一些前端辅助工具，就是把全部 JS 和 CSS 拼接成一个文件然后 minifier，JS 还要在 uglify 混淆，其实都不太好用，还不如我自己写个 gulpfile。</p>
<h2 id="sentry">接入 Sentry 和部署问题<a class="headerlink" href="#sentry" title="Permanent link">&para;</a></h2>
<p>最后介绍了如何接入 Sentry，Python 这样的动态语言，没有类型，要在运行时才会报错，很难在最开始就把代码中的异常处理都考虑到，所以就需要 Sentry 这样的捕获工具。作为一个『全干』工程师，部署应用，服务器 trouble shotting 也是一项必须掌握的技能。其实 Django 非常容易部署，只要选对了发行版，我对比下来用 Ubuntu 是最方便的，环境问题最少，熟练的话从启动服务器到完成二十分钟就能搞定。</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="structure/" title="Structure" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Structure
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Chen Jian
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/lsdlab" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./assets/javascripts/application-6b4ff16fa7.js"></script>
      <script>app.initialize({url:{base:"."}})</script>
      
    
    
      
    
  </body>
</html>